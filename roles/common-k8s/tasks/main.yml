- name: Disable swap
  ansible.builtin.command: swapoff -a

- name: Remove swap entry from /etc/fstab
  ansible.posix.mount:
    backup: yes
    opts: sw
    fstype: swap
    path: none
    state: absent
      
- name: Loading br_netfilter module for iptables to see bridged traffic
  community.general.modprobe:
    name: br_netfilter
    state: present

- name: Copy kernel module configuration
  ansible.builtin.copy:
    src: kernel-module-k8s.conf
    dest: /etc/modules-load.d/
        
- name: Copy sysctl configuration
  ansible.builtin.copy:
    src: 60-sysctl-k8s.conf
    dest: /etc/sysctl.d/
        
- name: Letting iptables see bridged traffic - sysctl
  ansible.builtin.command: sysctl -p /etc/sysctl.d/60-sysctl-k8s.conf
